<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Each &#8212; pybedtools 0.10.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=82662543"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the history and tags" href="history.html" />
    <link rel="prev" title="Filtering" href="filtering.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="each">
<h1>Each<a class="headerlink" href="#each" title="Link to this heading">¶</a></h1>
<p>Similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.filter()</span></code>, which applies a function to return True
or False given an <code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code>, the <code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.each()</span></code> method applies a
function to return a new, possibly modified <code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code>.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.each()</span></code> method applies a function to every feature.  Like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.filter()</span></code>, you can use your own function or some pre-defined
ones in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">featurefuncs</span></code> module.  Also like <code class="xref py py-meth docutils literal notranslate"><span class="pre">filter()</span></code>, <code class="file docutils literal notranslate"><span class="pre">*args</span></code>
and <code class="file docutils literal notranslate"><span class="pre">**kwargs</span></code> are sent to the function.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">pybedtools</span><span class="o">.</span><span class="n">example_bedtool</span><span class="p">(</span><span class="s1">&#39;a.bed&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">pybedtools</span><span class="o">.</span><span class="n">example_bedtool</span><span class="p">(</span><span class="s1">&#39;b.bed&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The results of an &quot;intersect&quot; with c=True will return features</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># with an additional field representing the counts.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_counts</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s define a function that will take the number of counts in each feature
as calculated above and divide by the number of bases in that feature.  We
can also supply an optional scalar, like 0.001, to get the results in
“number of intersections per kb”.  We then insert that value into the score
field of the feature.  Here’s the function:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">normalize_count</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">scalar</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<span class="gp">... </span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="sd">    assume feature&#39;s last field is the count</span>
<span class="gp">... </span><span class="sd">    &quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">counts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">normalized</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">counts</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># need to convert back to string to insert into feature</span>
<span class="gp">... </span>    <span class="n">feature</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">feature</span>
</pre></div>
</div>
<p>And we apply it like this:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">normalized</span> <span class="o">=</span> <span class="n">with_counts</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">normalize_count</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span>
<span class="go">chr1        1       100     feature1        0.0     +       0</span>
<span class="go">chr1        100     200     feature2        10.0    +       1</span>
<span class="go">chr1        150     500     feature3        2.86    -       1</span>
<span class="go">chr1        900     950     feature4        20.0    +       1</span>
</pre></div>
</div>
<p>Similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.filter()</span></code>, we could have used the Python built-in
function <code class="file docutils literal notranslate"><span class="pre">map</span></code> to map a function to each <code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code>.  In fact, this can
still be useful if you don’t want a <code class="xref py py-class docutils literal notranslate"><span class="pre">BedTool</span></code> object as a result.  For
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_lengths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the <code class="xref py py-meth docutils literal notranslate"><span class="pre">BedTool.each()</span></code> method returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">BedTool</span></code> object,
which can be used in a chain of commands, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">normalize_count</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">lamda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-5</span><span class="p">)</span>
</pre></div>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pybedtools</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="main.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="main.html#running-tests-compiling-docs">Running tests, compiling docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-brief-examples.html">Three brief examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial-contents.html">Tutorial Contents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Intro</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-a-bedtool-tutorial.html">Create a <code class="xref py py-class docutils literal notranslate"><span class="pre">BedTool</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="intersections.html">Intersections</a></li>
<li class="toctree-l2"><a class="reference internal" href="save-results.html">Saving the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="default-arguments.html">Default arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="piping.html">Chaining methods together (pipe)</a></li>
<li class="toctree-l2"><a class="reference internal" href="piping.html#operator-overloading">Operator overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="intervals.html">Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering.html">Filtering</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Each</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html">Using the history and tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="history.html#deleting-temp-files-specific-to-a-single-bedtool">Deleting temp files specific to a single <code class="xref py py-class docutils literal notranslate"><span class="pre">BedTool</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="topical-documentation-contents.html">Topical Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQs.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="autodoc_source.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pybedtools</span></code> Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="tutorial-contents.html">Tutorial Contents</a><ul>
      <li>Previous: <a href="filtering.html" title="previous chapter">Filtering</a></li>
      <li>Next: <a href="history.html" title="next chapter">Using the history and tags</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="history.html" title="Using the history and tags"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="filtering.html" title="Filtering"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pybedtools 0.10.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial-contents.html" accesskey="U">Tutorial Contents</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Each</a></li> 
      </ul>
    </div>


    <div class="footer">
      &#169;2010-2015, Ryan Dale.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/each.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>